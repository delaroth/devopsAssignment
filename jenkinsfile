pipeline {
    agent any
    // parameters {
    //     string(name: 'DEPLOY_PATH', defaultValue: '/usr/share/nginx/html', description: 'Path to deploy the HTML project.')
    // }
    stages {
        stage('Fetch consul info') {
            steps {
                sh '''
                echo Fetching configuration from Consul...
                consul kv get html/config > config.json
                echo Configuration fetched successfully:
                cat config.json
                 '''
                            }
        }
        stage('Parse Config') {
            steps {
                sh '''
                echo Parsing configuration...
                DEPLOY_PATH=$(jq -r '.deploy_path' config.json)
                ENV=$(jq -r 'env' config.json)
                echo "Deployment Path: $DEPLOY_PATH"
                echo "Environment: $ENV"
                '''
            }
        }
        stage('Deploy to NGINX') {
            steps {
                sh '''
                cd webApp
                echo Deploying application to NGINX server...
                sudo rm -rf $DEPLOY_PATH/*  # Clear existing files in the NGINX directory
                sudo cp -r * $DEPLOY_PATH  # Copy new files to NGINX directory
                echo Deployment completed successfully!
                '''
            }
        }
    }
}
